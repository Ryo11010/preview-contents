# Plan — Edit 20251204_230100__app-native-ready

## 背景 / 目的
- `app.tsx` の技術負債（重複ロジック・インライン定数の散在・DOM 前提の処理）を解消し、安定性とメンテナンス性を高める。
- UI/機能/Canvas プレビューを一切変えずに単一ファイル構成を維持しつつ、将来の React Native 移行を見据えた構造（プラットフォーム分離しやすいヘルパー/コンポーネント化）に整える。

## 参照 (Fail-Avoid / Success-Reuse)
- Failure 事例: なし（/artifacts に未登録）。
- Success 事例: なし（/artifacts に未登録）。
- Workset ガードレール: 各会話=1修正・3+1必須、単一ファイル維持、ハードコード絶対禁止、500 行ルールに留意、UI/挙動/プレビュー不変。

## agents.md 重要ポイント（抜粋）
- ハードコード絶対禁止：環境/運用で変わる値（URL・文言など）は定数/設定に集約し、ロジック内に直書きしない。
- A/B/C 方式で代替案を提示し採用案を明示する。
- 3+1（before/after/diff/meta）と `file-map.md` 更新を必須とする。
- 命名規則: 英語・意味明確、真偽値は is*/has* など。500 行ルール超過時は理由を明示。
- コンソール禁止・デバッグはオーバーレイ方針（今回新規実装は行わない）。

## 代替案 (A/B/C)
- (A) 単一ファイル内でデータ/スタイルトークン/文言をセクション化し、プラットフォーム依存の処理（scroll/share/navigation）を小さなヘルパーに隔離。コンポーネント props を型安全に整理し、重複 UI をサブルーチン化。Pros: 負債削減と RN への移行容易化。Cons: リファクタ量中。影響: 低〜中。コスト: 中。
- (B) インラインリファクタのみ（命名・軽微な整理）で大規模な構造変更を避ける。Pros: 工数小。Cons: 負債残存、RN 互換性向上が限定的。影響: 低。コスト: 低。
- (C) ファイル分割や大幅デザイン変更を伴う再実装。Pros: 抜本的整理。Cons: 単一ファイル・UI不変の要件に抵触しリスク大。影響: 高。コスト: 高。

### 採用案
- **(A) を採用**。単一ファイルと UI 不変を守りつつ、データ/ヘルパー集約とプラットフォーム依存箇所の隔離で安定性と RN 移行性を両立できるため。

## 影響範囲
- 機能/挙動: Hero/Work/Timeline/About/Sheet/Dock/シェア/メール/スクロール監視の UI 挙動は変えない。
- 構造: 定数・型の整理、プラットフォームガード付きヘルパーの追加、セクションコンポーネントの小規模再編のみ。
- パフォーマンス: ハンドラーのメモ化・再利用で微改善を狙うが体感挙動は不変。

## テスト計画
- 手動: セクションスクロール/ドック遷移、フォルダ展開とカード選択→シート開閉、タイムラインからの遷移、シェア/メール起動、Canvas プレビュー表示を確認。
- 自動: lint/型チェックは可能なら実行（環境で不可なら理由を記録）。

## ハードコードに関する計画
- 既存の文言/リンク/スタイルトークンを冒頭の定数セクションに整理し、ロジック内への新規直書きを禁止。
- 環境依存の操作（share/mail/openExternal/scroll）をガード付きヘルパーにまとめ、値を渡す箇所も定数経由に統一。
- 新規の URL/ID/トークン/閾値は追加しない。やむを得ない場合は定数化とコメントで差し替え前提を明示する。

## ロールバック方針
- `before/after` スナップショットを保存し、問題時は `app.tsx` を before 版に戻す。
- ヘルパー/定数化は JSX 構造を変えないため、個別の移動を巻き戻すことで復旧可能。

## 相談・承認
- status: yes
- approver: user
- time: 2025-12-05T00:00:00Z
- memo: user より「yes」を受領したため実装を開始する。
