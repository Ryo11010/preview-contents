# Plan — Edit 20251204_214311__app-hardening

## 背景 / 目的
- `app.tsx` に残る技術負債（重複 JSX・散在するスタイル/文言・副作用ハンドリングの雑さ）を解消し、安定性とメンテナンス性を高める。
- 既存の UI / 機能 / Canvas プレビューと単一ファイル構成を維持したまま、構造化と型安全性を強化する。

## 参照 (Fail-Avoid / Success-Reuse)
- Failure 事例: なし（/artifacts に未登録）。
- Success 事例: なし（/artifacts に未登録）。
- Workset ガードレール: 3+1 必須、単一ファイル維持、ハードコード絶対禁止、500 行ルールに留意（分割困難な場合は理由を明記）。

## agents.md 重要ポイント（抜粋）
- ハードコード絶対禁止：環境/運用で変わる値（URL・文言など）は定数セクションに集約し、ロジック中に直接埋め込まない。
- A/B/C 方式で代替案を提示し、採用案を明示する。
- 3+1（before/after/diff/meta）と `file-map.md` 更新を各 Edit で必須とする。
- 命名規則（英語・意味明確、真偽値は is*/has* など）と 500 行ルールを守り、読解性を損ねない。
- Console デバッグ禁止（必要時はオーバーレイだが今回は実装しない方針）。

## 代替案 (A/B/C)
- (A) データ/文言/スタイルトークンを定数に集約し、セクションごとのプレゼンテーションコンポーネントを切り出してロジックと表示を分離する。副作用ハンドラーを整理し、型安全なユーティリティを追加。UI/挙動は変えない。Pros: 負債削減と可読性向上。Cons: 既存 JSX の分割作業が必要。影響: 低〜中。コスト: 中。
- (B) 軽微なリント修正のみで大きな構造変更を避ける。Pros: 工数最小。Cons: 負債が残り品質向上にならない。影響: 低。コスト: 低。
- (C) 複数ファイル分割やデザイン刷新を行う。Pros: 抜本的整理。Cons: 単一ファイル維持/挙動不変の要件に反する。影響: 高。コスト: 高。

### 採用案
- **(A) を採用**。単一ファイルかつ UI 不変の条件を守りつつ、定数化とコンポーネント分割（同一ファイル内）で負債を減らせるため。

## 影響範囲
- UI/挙動: 既存の見た目・アニメーション・Canvas プレビュー・スクロール/ドック/シート/アーカイブ動作を維持。
- 構造: 定数/型/ユーティリティの集約とセクションごとの小コンポーネント化のみ。
- パフォーマンス: 不要な再生成を減らし、ハンドラーの再利用で微改善を狙うが挙動は変えない。

## テスト計画
- 手動: セクションスクロール（ドック/CTA）、プロジェクトカード選択→シート開閉、アーカイブ一覧→選択、シェア/問い合わせボタン、タイムラインのクリック遷移を確認。
- 自動: 追加テスト基盤は未整備のためなし。lint/型チェックは可能なら実行。

## ハードコードに関する計画
- コンテンツ値（プロフィール・プロジェクト・タイムライン文言）とスタイルトークンを定数セクションにまとめ、ロジック内に埋め込まない。
- メールリンク/外部リンクは意味のある定数経由に統一し、新規の環境依存値（URL/ID/トークン/閾値）を追加しない。
- 例外なくハードコードを避け、必要ならコメントで差し替え前提を明記する。

## ロールバック方針
- `app.tsx` の変更前スナップショットを `before/` に保存し、問題時は復元する。
- コンポーネント化は JSX 構造を維持したまま行うため、部分的に定数/ハンドラーを戻すことでロールバック可能。

## 相談・承認
- status: **yes**
- approver: user
- time: 2025-12-04 21:45 JST
- memo: 「yes」の承認を受領したため実装開始。
