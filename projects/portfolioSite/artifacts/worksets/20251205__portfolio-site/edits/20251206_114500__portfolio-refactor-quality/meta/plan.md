# Plan — Edit 20251206_114500__portfolio-refactor-quality

## 背景 / 目的
- ポートフォリオ実装を本番品質に揃えるため、UIを変えずにロジック・データ分離と設計/命名の徹底リファクタを行い、agents.md のコード品質基準に完全準拠させる。
- 文言や閾値のハードコードを排除し、設定/定数/データモジュールに集約して今後の更新を容易にする。

## 参照 (Fail-Avoid / Success-Reuse)
- Failure 事例: failure-cases は登録なし。3+1 漏れ・file-map 未更新・Plan 未承認のまま実装をしないよう注意。
- Success 事例:
  - 20251205_192700__postcss-explicit-config — 設定を明示化してレンダリング崩れを防止。今回も設定/定数を明示管理する方針を踏襲。
  - Workset 成功ポイント `app-debt-burndown` — 型/定数集中とガード徹底。文言・閾値をデータ/定数に寄せ、ガード付きヘルパーを維持。
  - Workset 成功ポイント `app-native-ready` — プラットフォーム依存処理のユーティリティ集約。リンク/シェア系の副作用はユーティリティへ閉じ込める。
  - Workset 成功ポイント `app-hardening` — セクション分割とトークン集約でUIを維持しつつ可読性向上。今回もセクション別コンポーネントとトークンを整理。

## agents.md 重要ポイント（抜粋）
- ハードコード絶対禁止：URL/文言/閾値/フラグは設定・定数・データモジュールに切り出す。
- 各会話=1修正・3+1必須・file-map 省略禁止。Plan 承認前は実装出力禁止。
- A/B/C 代替案提示と採用案明示。500行ルール/命名規約順守、不要変更禁止。
- Web デバッグはコンソール禁止（既存遵守）、no-console ルール維持。

## 代替案 (A/B/C)
- (A) 文言/トークンを専用モジュールへ集約し、各セクション・複合コンポーネントの責務を分離・小型化する（背景/ボタン/セクションコピー/フォルダ挙動をトークン化）。UIはそのまま。
  - Pros: ハードコード排除と可読性向上を両立。更新容易。
  - Cons: 触るファイルが多くなる。
- (B) 型注釈と軽微なリネーム中心の最小リファクタに留める。
  - Pros: 影響範囲最小。
  - Cons: ハードコード残存や設計負債が解消されず、品質目標未達。
- (C) コンポーネントをフル再実装（デザイン体系変更含む）。
  - Pros: 理想設計を一気に導入可能。
  - Cons: UI崩れ/工数増大リスクが高く、要求の「UIを損なわない」に反する。

### 採用案
- **(A) を採用。** 現行UIを維持しつつ、コピー/トークン/挙動計算をモジュール化してハードコードを排除し、責務を明確化する。

## 影響範囲
- `site/app/page.tsx`（セクション構成・ハンドラの整理）
- `site/src/components/**`（セクション/複合コンポーネントのロジック分離・トークン適用）
- `site/src/config/**` / `site/src/data/**`（コピー・閾値・背景/レイアウトトークン追加）
- 不要コード/未使用定義の削除。UIの見た目・挙動は維持。

## テスト計画
- `npm run lint`（lint/型エラーがないことを確認）
- `npm run build`（App Router ビルドが通り、型とランタイムエラーが出ないことを確認）

## ハードコードに関する計画
- セクション見出し・CTA文言・説明テキスト・通知文言 → `config`/`data` のコピー定義に集約。
- 背景グラデーション色・アニメーション秒数・フォルダ展開のメトリクス（spread/tilt/shift）・ドックサイズ/余白 → `tokens` に移動。
- 閾値/ブレークポイント/シェア文言/メールリンクなど環境依存値は既存設定/ユーティリティ経由でのみ使用し、コンポーネント内リテラルを排除。

## ロールバック方針
- `artifacts/worksets/20251205__portfolio-site/edits/20251206_114500__portfolio-refactor-quality/before` のスナップショットと `git diff` を用い、変更ファイルを元に戻すことで復旧可能。

## 相談・承認
- status: yes
- approver: user
- time: 2025-12-06T02:55:00Z
- memo: ユーザーより「yes」承認済み。UIを変えず品質強化のみ実施。
