ファイル名: `PreviewContentsSite_Requirements_v1.0.md`

---

## 1. 基本情報

* プロジェクト名: Preview Contents Site（社内向けWebプレビュー基盤）
* バージョン: 1.0
* 作成日: 2025-12-07
* 作成者: （記入予定）
* ドメイン: `preview-contents.site`
* 利用サーバー: 既存社内HPと同一の Xserver 環境

本ドキュメントは、React、React Native、静的HTMLサイトなど複数種類のフロントエンド成果物を、社内向けクローズドテスト用にホスティングする「プレビュー専用」Web基盤の要件定義書です。

---

## 2. 背景・目的

### 背景

* 現状、各プロジェクトごとに個別のプレビュー環境を用意しており、URLの管理・共有が煩雑になりやすいです。
* React、React Native、静的HTMLサイトなど技術スタックが複数に分かれており、プレビュー手段が統一されていません。
* 社内向けのクローズドテストを行う際、毎回環境を説明したり、ZIPファイルを共有したりするコストが発生しています。

### 目的

* ドメイン `preview-contents.site` 配下に、複数プロジェクトのビルド成果物をディレクトリ単位で配置し、一元的にプレビューできる基盤を整備すること。
* 既存の Xserver を流用し、追加コストを抑えつつ、プレビュー環境の構築・運用を標準化すること。
* 社内メンバー（開発者、テスター、ビジネス担当）が迷わずアクセスできる「プレビューの入口」を提供すること。

---

## 3. ステークホルダー

| 区分    | ロール                                 | 役割                                      |
| ----- | ----------------------------------- | --------------------------------------- |
| ビジネス側 | プロダクトオーナー / 依頼部門                    | どのプロジェクトをプレビュー対象とするか、利用ポリシーを決定します。      |
| 開発側   | フロントエンド開発者（React/React Native/HTML） | ビルド成果物の作成と、プレビュー環境へのデプロイを実施します。         |
| 開発側   | インフラ担当 / Web担当                      | Xserver 上でのドメイン設定、ディレクトリ構成、認証設定などを行います。 |
| 品質保証  | QA / テスター                           | プレビュー環境を利用して動作確認・受入テストを実施します。           |
| 運用    | システム運用担当                            | アカウント管理、障害対応、ログ確認など日々の運用を行います。          |

※ 個人名・部署名などの詳細は別途決定とします。

---

## 4. スコープ

### スコープ内

* `preview-contents.site` ドメイン配下でのマルチプロジェクト・プレビュー基盤の構築
* 静的HTMLおよびビルド済みフロントエンド（React, React Native Web 等）のホスティング
* Xserver 上でのディレクトリ構成・`.htaccess` 設計（React SPA 等のルーティング対応を含む）
* 社内クローズド向けの認証（Basic認証など）の導入
* プロジェクト別プレビューURLの命名規則定義
* シンプルな「プレビュー一覧」トップページの提供

### スコープ外（現時点）

* 本番環境のホスティング・トラフィック対応
* 複雑な権限管理（ユーザーごとのID管理、RBACなど）
* 高度なリリース管理機能（Blue/Green Deployment、カナリアリリース等）
* プレビューからの本番デプロイ連携機能
* バックエンドAPIサーバーの構築（プレビュー対象アプリが外部APIを利用する場合、それは別管理）

---

## 5. 目標／KPI

### 目標

* 複数のフロントエンドプロジェクトを「1つのドメイン」「共通ルール」でプレビューできる状態にすること。
* プレビューURLの発行・共有にかかる時間を短縮すること。
* 社内からのアクセスに対して、最低限のセキュリティ（認証とHTTPS）を担保すること。

### KPI（例）

* 新規プロジェクトのプレビューURL準備時間を **1営業日以内** にする。
* プレビュー環境でのアクセスエラー報告件数を **月1件以下** に抑える。
* プレビュー閲覧までの案内（説明資料・手順）が1ページ以内に収まる状態にする。

---

## 6. ターゲットユーザー

* 社内フロントエンド開発者

  * React / React Native / HTML によるフロントエンド開発者
* 社内QA / テスター

  * 結合テスト・受入テストで画面確認を行う担当者
* ビジネスサイド

  * ディレクター、プロダクトオーナー、営業など、画面レビューを行う担当者
* 社外協力会社（必要に応じて）

  * アクセス権限を付与されたパートナー企業（認証配布前提）

---

## 7. システム構成

### 概要

* 既存の Xserver 上に `preview-contents.site` を追加ドメインとして設定します。
* ドキュメントルート配下に、プロジェクトごと・環境ごとにディレクトリを作成し、ビルド済み成果物を配置します。
* ルート (`/`) にはプレビュー一覧ページ（インデックス）を配置します。
* 認証はXserver標準の Basic認証機能等を利用します。

### 構成イメージ（Mermaid）

```mermaid
flowchart LR
    Dev[開発者<br/>Front-end Developer]
    QA[テスター / ビジネス担当]
    XSRV[(Xserver<br/>共用サーバー)]

    Dev -->|ビルド成果物アップロード<br/>(SFTP / CI/CD)| XSRV
    QA -->|HTTPSアクセス<br/>https://preview-contents.site/...| XSRV
```

### ディレクトリ構成（案）

Xserver 上のディレクトリ例:

* `/preview-contents.site/`（ドキュメントルート）

  * `/index.html` … プロジェクト一覧ページ
  * `/{project-key}/{environment}/` … 各プロジェクトのビルド成果物

    * 例: `/customer-portal/stg/`
    * 例: `/native-app/login-revamp/`
    * 例: `/static-lp/campaign-2025/`

`project-key` および `environment` の詳細ルールは本ドキュメント内で定義し、TODO で確定します。

---

## 8. 機能要件

### FR-001: ディレクトリベースのマルチプロジェクト構成

* `https://preview-contents.site/{project-key}/{environment}/` 形式で、複数プロジェクトのプレビューを同時に提供できること。
* `project-key` は英数字小文字およびハイフン（`[a-z0-9-]`）で構成され、一意であること。
* `environment` は `dev`, `stg`, `test`, `pr-xxxx` など任意の文字列を許容すること。

### FR-002: 静的HTMLサイトのプレビュー

* 純粋な静的HTML/CSS/JavaScriptから構成されるサイトを、そのまま `/static-lp/...` 等に配置してプレビューできること。
* 相対パス・絶対パス双方の参照において、基本的な表示崩れが起きないこと。

### FR-003: Reactアプリケーション（SPA）のプレビュー

* Create React App などでビルドされた SPA（Single Page Application）を配置し、プレビューできること。
* クライアントサイドルーティングを行う場合、`/path/to/page` で直接アクセスされた際に 404 とならず、`index.html` に内部リダイレクトされる `.htaccess` 設定を行うこと。
* ビルド成果物の一般的な構成（`index.html`・`/static` ディレクトリなど）に対応すること。

### FR-004: React Native Web ビルドのプレビュー

* React Native プロジェクトを Web 向けにビルドした成果物（例: Expo for Web のビルド）を配置し、プレビューできること。
* Metro Bundler 等のランタイムは利用せず、あくまで「ビルド済み静的成果物」としてホスティングすること。
* 必要に応じて SPA 同様のルーティング対応（`.htaccess`）を行うこと。

### FR-005: プロジェクト一覧ページ（インデックス）の提供

* `https://preview-contents.site/` へのアクセス時に、現在配置されている主なプレビューURLを一覧表示するページを提供すること。
* 最低限、以下の情報を表示できること。

  * プロジェクト名（表示名）
  * project-key
  * environment（例: dev/stg/pr-1234）
  * プレビューURL
  * 備考（任意）
* 初期段階では静的HTML/JSON等によるシンプルな実装（手動更新）を想定します。

### FR-006: 認証によるアクセス制御（社内クローズド）

* `preview-contents.site` 配下に Basic認証などのアクセス制御を設定できること。
* 認証情報（ID/パスワード）は、社内向けに限定配布すること。
* 将来的な要件として、IP制限やVPNなど追加のアクセス制御オプションを考慮できる構成とすること（実装タイミングは別途）。

### FR-007: HTTPS 対応

* `https://preview-contents.site` でアクセス可能とし、証明書は Xserver 提供のもの（無料SSLなど）を利用すること。
* HTTP でアクセスされた場合、HTTPS へリダイレクトさせること。

### FR-008: アクセスログ取得

* Xserver 標準機能で取得できるアクセスログを利用し、以下を把握できること。

  * アクセスURL
  * アクセス日時
  * ステータスコード
  * 利用ユーザーのIP等（標準ログ範囲）
* ログの保管期間は Xserver の仕様に準拠し、必要があれば定期的にダウンロード・保管を行う運用を想定します。

### FR-009: エラーページ／メンテナンスページ

* 404/500 などのエラー発生時に、簡易なカスタムエラーページを表示できること。
* 全体メンテナンス時に、`preview-contents.site` 全体をメンテナンスページへ切り替えられること（`.htaccess` または Xserver 機能で対応）。

### FR-010: デプロイ方法の標準化

* 少なくとも以下のいずれかの方法で、ビルド成果物を Xserver に配置できること。

  * 手動アップロード（SFTP）
  * CI/CD ツール（例: GitHub Actions）からの自動アップロード
* デプロイ先ディレクトリのルール（`/{project-key}/{environment}/`）を明確にし、開発メンバー間で共有できること。

---

## 9. 非機能要件

### NFR-001: 可用性

* Xserver の提供する SLA の範囲内で運用し、想定利用時間（主に平日日中）において **99% 程度** の可用性を目標とします。
* 基盤側での特別な冗長構成は行わず、既存Xserver構成に準拠します。

### NFR-002: 性能

* 一般的な社内ネットワーク環境からアクセスした際、トップページおよび代表的なプレビューページの初回表示が **3秒以内** を目安とします（画像・動画など大容量コンテンツは除外）。
* ビルド成果物側でのパフォーマンス最適化（アセット圧縮、画像最適化など）は各プロジェクトの責任範囲とします。

### NFR-003: セキュリティ

* Basic認証または同等の仕組みにより、一般公開されない状態を維持します。
* プレビュー環境では、原則として実ユーザーの個人情報を扱わないことを基本方針とします。

  * やむを得ずテスト用に個人情報相当のデータを扱う場合、日本の個人情報保護法および関連ガイドラインに準拠した取扱いとし、ダミーデータ・マスキングなどの対応を検討します。
* HTTP は HTTPS にリダイレクトし、平文通信の利用を避けます。

### NFR-004: スケーラビリティ

* 同時に保持できるプレビュープロジェクト数の目安を決め（例: 20〜50プロジェクト）、Xserver のディスク容量と相談しながら運用します。
* 古いプレビュー（使われなくなったブランチのビルドなど）を定期的に削除する運用ルールを設けます。

### NFR-005: 運用性・保守性

* ディレクトリ命名規則、デプロイ手順、削除ルールをドキュメント化し、少なくとも1名以上の担当者が引き継げる状態にします。
* 障害時（表示不可、証明書切れなど）の一次対応フローを用意します。

### NFR-006: 監視・ログ

* Xserver の管理画面からアクセスログ・エラーログを閲覧できる状態を維持します。
* 異常が疑われる場合、アクセスログ・エラーログを確認する手順を運用ドキュメント化します。

### NFR-007: 法令・規約

* Xserver の利用規約に違反しない範囲で運用します。
* 個人情報、および機密情報を扱う場合は、社内情報セキュリティポリシーおよび個人情報保護法等を遵守します。

### NFR-008: ブラウザサポート

* プレビュー閲覧の想定ブラウザを明示します（例）：

  * PC: 最新版の Google Chrome, Microsoft Edge
  * モバイル: iOS Safari, Android Chrome（最新版付近）
* 各プロジェクト固有の対応ブラウザはプロジェクト側で定義し、本基盤は「主要ブラウザで表示できること」を最低条件とします。

---

## 10. UI / UX

### プレビュー一覧ページのUI方針

* シンプルで見やすく、一覧性を重視します。
* 例として以下のようなテーブル形式を想定します。

| プロジェクト名     | project-key     | environment   | プレビューURL                                                 | 備考     |
| ----------- | --------------- | ------------- | -------------------------------------------------------- | ------ |
| 顧客ポータル      | customer-portal | stg           | `https://preview-contents.site/customer-portal/stg/`     | ステージング |
| ネイティブアプリWeb | native-app      | login-revamp  | `https://preview-contents.site/native-app/login-revamp/` | ログイン改修 |
| LP キャンペーン   | static-lp       | campaign-2025 | `https://preview-contents.site/static-lp/campaign-2025/` | 新施策LP  |

### UX ガイドライン

* プレビュー一覧ページから、クリック1回で目的のプレビューに遷移できること。
* プロジェクト数が増えた場合に備え、将来的には簡易検索（ページ内検索）やグルーピングなどを検討できる構成とします（初期は必須としない）。
* Basic認証のID/パスワードは、わかりやすく、かつ安全性も確保したものとし、社内共有のチャネルを統一します。

---

## 11. データ要件

* 本プレビュー基盤自体はデータベースを持たず、静的ファイル（HTML/CSS/JS/画像等）のみを基本とします。
* 各プロジェクトが外部APIやバックエンドと連携する場合、そのデータ管理は当該プロジェクトの本来の環境側で行われ、本プレビュー基盤は関与しません。
* プレビュー用のモックデータを同梱する場合は、個人情報・機密情報を含まないダミーデータとすることを推奨します。

---

## 12. 外部インタフェース

* ネットワーク:

  * インターネット経由で `preview-contents.site` にアクセスします。
  * 社内のみを想定しつつも、実際には一般インターネットからのアクセスが可能な構成となるため、認証で制御します。
* CI/CD 連携（任意）:

  * GitHub Actionsなどから SFTP で Xserver にビルド成果物をアップロードする場合があります。
  * CI/CD 用の接続情報（ホスト、ユーザー名、鍵 等）は社内で安全に管理します。

---

## 13. 制約・前提

* サーバーは既存社内HPをホスティングしている Xserver を流用します。

  * したがって、利用可能なミドルウェア・設定は Xserver の仕様に制約されます（任意の Node.js サーバー常駐などは前提としません）。
* プレビュー環境はあくまで「開発・テスト目的」であり、本番トラフィックを想定した高負荷対応は行いません。
* ドメイン `preview-contents.site` は既存Xserverサーバーへ向けてDNS設定されるものとします。
* プレビュー対象プロジェクトはすべてビルド済み静的ファイルとして提供されることを前提とします。

---

## 14. 受入基準

* `https://preview-contents.site/` にアクセスし、Basic認証を通過するとプレビュー一覧ページが表示されること。
* 代表プロジェクト（React/React Native Web/静的HTML 各1件）について、指定されたURLにアクセスすると期待どおりの画面が表示されること。
* React/React Native Web プロジェクトにおいて、サブパス直接アクセス（例: `/customer-portal/stg/settings`）でも 404 とならず、アプリが表示されること。
* HTTPS 接続が有効であり、ブラウザ警告（証明書不正等）が出ないこと。
* アクセスログが取得されていることを Xserver 管理画面等で確認できること。

---

## 15. マイルストーン

※ 日付は仮の段階とし、後で具体化します。

1. 要件定義完了

   * 本ドキュメント v1.0 承認
2. 基盤設計・設定

   * Xserver ドメイン設定
   * ディレクトリ構成・`.htaccess` 設定
   * Basic認証設定
3. 初期プロジェクト適用

   * 静的HTML案件1件のプレビュー構築
   * React案件1件のプレビュー構築
   * React Native Web案件1件のプレビュー構築
4. 運用ドキュメント整備

   * デプロイ手順書
   * プレビューURL命名規則ドキュメント
   * アクセス権限配布手順
5. 本格運用開始

   * 開発全プロジェクトへの案内
   * フィードバック収集と改善計画策定

---

## 16. リスクと課題

* ドメインがインターネット公開であるため、認証設定不備により社外からアクセス可能となってしまうリスク。
* Xserver の仕様変更や制限強化により、将来的に CI/CD やルーティング設定に影響が出る可能性。
* ディレクトリ構成・命名規則が守られない場合、一覧ページとの不整合や「どれが最新か分からない」という問題が発生しうること。
* プレビュー環境に本番相当のデータを持ち込んだ場合、情報漏えいリスクが高まる可能性。
* プロジェクト数やビルドサイズが増えた場合、ディスク容量逼迫やパフォーマンス劣化の懸念。

---

## 17. 変更履歴

| 版   | 日付         | 変更内容 | 作成者    |
| --- | ---------- | ---- | ------ |
| 1.0 | 2025-12-07 | 初版作成 | （記入予定） |

---

## 18. 付録

* プロジェクト共通規則ファイル: `PROJECT_CONVENTIONS.md`

  * コーディング規約、ブランチ戦略、レビュー方針など、本プロジェクト全体に共通するルールは `PROJECT_CONVENTIONS.md` を参照します。
  * 本要件定義書では、同ファイルの内容は引用せず、参照のみとします。

---

## 19. バージョン指定規則

### 19.1 ドキュメントのバージョン

* 本要件定義書のバージョンは `X.Y` の数値形式とします。

  * `X`（メジャー）：要件の大きな変更・方針転換があった場合にインクリメントします（例: 1.0 → 2.0）。
  * `Y`（マイナー）：軽微な要件追加や修正を行った場合にインクリメントします（例: 1.0 → 1.1）。
* 変更内容は別途 `CHANGELOG.md` に追記します。

### 19.2 システム／成果物のバージョン方針（概念）

* 参考として、Semantic Versioning 2.0.0 の考え方を取り入れつつ、以下のレイヤごとにバージョンを管理します。

  1. **プレビュー基盤（本サイト構成・インフラ）**

     * 例: `infra-1.0`, `infra-1.1` など、インフラ構成変更単位でバージョンを付与。
  2. **各プレビュープロジェクトのフロントエンド成果物**

     * 各プロジェクトリポジトリ側で SemVer 等のバージョンを管理。
     * プレビューURLの `environment` 部分にブランチ名・PR番号などを含めることで、バージョンや変更内容と紐付けます（例: `/customer-portal/pr-1234/`）。
  3. **ドキュメント（要件定義書・設計書）**

     * 本ドキュメント同様 `X.Y` 形式で管理し、`CHANGELOG.md` に変更履歴を記録します。

### 19.3 レイヤ間のバージョン同期手順（本プロジェクト向け）

* プレビュー基盤（インフラ）のバージョンを更新する際は、以下を行います。

  * `infra` バージョンの更新
  * 本要件定義書のバージョン更新（必要に応じて）
  * `CHANGELOG.md` への記載
* 各フロントエンドプロジェクトは、それぞれの開発リポジトリでのバージョン管理を行い、プレビューURL と紐付けて管理します。

### 19.4 CHANGELOG 更新タイミング

* 以下のタイミングで `CHANGELOG.md` を更新します。

  * 要件定義書のバージョンを変更したとき
  * プレビュー基盤の構成に影響する変更（例: ディレクトリ構成変更、認証方式変更）が行われたとき
* 記載内容は、変更日・変更者・概要・対象バージョンを含めます。

---